<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Hola Mundo con D3.js</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
</head>
<body>
    <h1>Visualización de JSON con D3.js</h1>
    <p>Lectura de datos desde un archivo JSON.</p>

    <!-- SVG para visualizar datos -->
    <svg id="jsonDemo" width="400" height="400" style="border: 1px solid black;"></svg>

    <script>
    // Define la función para visualizar datos en el SVG
    function drawText(selector, data) {
        const svg = d3.select(selector);
        // Elimina cualquier texto existente
        svg.selectAll("text").remove();
        
        // Agrega texto para cada elemento del JSON
        svg.selectAll("text")
          .data(data) // Vincula los datos al SVG
          .enter() // Crea nuevos elementos de texto
          .append("text")
          .attr("x", 10) // Posición horizontal
          .attr("y", (d, i) => (i + 1) * 20) // Posición vertical (20px entre líneas)
          .text(d => d.id + ": " + d.value); // Muestra id y valor
    }

    // Carga el archivo JSON y muestra datos en el SVG
    d3.json("./test.json") // Reemplaza con la ruta correcta al archivo JSON
      .then(function(data) {
        console.log("Datos leídos:", data); // Para verificar datos en la consola

        drawText("#jsonDemo", data); // Muestra datos en el SVG
      })
      .catch(function(error) {
        console.error("Error al cargar el JSON:", error); // Captura errores al cargar JSON
      });
    </script>

<h1>Visualización de datos BNA</h1>
<p>Lectura de límites geográficos desde un archivo BNA.</p>

<!-- SVG para visualizar datos -->
<svg id="bnaDemo" width="400" height="400" style="border: 1px solid black;"></svg>

<script>
    // Función para dibujar líneas en el SVG
    function drawPaths(svg, segments) {
        segments.forEach(segment => {
            const path = d3.path(); // Objeto para crear el camino
            const coordinates = segment.coordinates;

            if (coordinates.length > 0) {
                // Inicia desde la primera coordenada
                path.moveTo(coordinates[0].x, coordinates[0].y);
                
                // Dibuja líneas entre las coordenadas
                for (let i = 1; i < coordinates.length; i++) {
                    path.lineTo(coordinates[i].x, coordinates[i].y);
                }

                // Añade el camino al SVG
                svg.append("path")
                  .attr("d", path.toString()) // Convierte el camino a cadena
                  .attr("stroke", "black") // Color de la línea
                  .attr("fill", "none"); // Sin relleno
            }
        });
    }

    // Cargar el archivo BNA
    d3.text("./states_usa.bna") // Asegúrate de tener la ruta correcta
      .then(function(data) {
        const lines = data.split("\n"); // Divide el contenido por líneas
        const segments = [];
        
        let currentSegment = null;

        // Procesa las líneas para extraer segmentos y coordenadas
        lines.forEach(line => {
            const trimmedLine = line.trim();

            if (trimmedLine) {
                const parts = trimmedLine.split(","); // Divide por coma

                if (parts.length === 3) {
                    // Nueva cabecera, iniciando un nuevo segmento
                    if (currentSegment) {
                        segments.push(currentSegment); // Añade el segmento anterior
                    }

                    currentSegment = { 
                        header: parts[0], 
                        coordinates: [] 
                    }; // Inicia nuevo segmento
                } else if (parts.length === 2) {
                    // Coordenadas, agregándolas al segmento actual
                    const coord = {
                        x: parseFloat(parts[0]), 
                        y: parseFloat(parts[1])
                    };
                    if (currentSegment) {
                        currentSegment.coordinates.push(coord);
                    }
                }
            }
        });

        // Añade el último segmento al final del procesamiento
        if (currentSegment) {
            segments.push(currentSegment);
        }

        const svg = d3.select("#bnaDemo"); // Selecciona el SVG
        drawPaths(svg, segments); // Dibuja los segmentos
      })
      .catch(function(error) {
        console.error("Error al cargar el archivo BNA:", error); // Captura errores
      });
</script>


</body>

</html>
